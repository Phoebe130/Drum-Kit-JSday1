<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>JS Drum Kit</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/ğŸ”¥" />
</head>

<!-- åŠŸèƒ½
1.åµæ¸¬æŒ‰ä¸‹çš„å­—æ¯æœƒæ’­æ”¾ç›¸æ‡‰çš„è²éŸ³
2.ASDFGHJKLä»¥å¤–çš„å…¶ä»–æŒ‰éˆ•ä¸åæ‡‰
3.æ·»åŠ ã€ç§»é™¤classList ï¼ˆå¤–æ¡†è®Šç‚ºé»ƒè‰²ã€å­—æ”¾å¤§ï¼‰ -->

<body>
  <div class="keys">
    <div data-key="65" class="key">
      <kbd>A</kbd>
      <span class="sound">clap</span>
    </div>
    <div data-key="83" class="key">
      <kbd>S</kbd>
      <span class="sound">hihat</span>
    </div>
    <div data-key="68" class="key">
      <kbd>D</kbd>
      <span class="sound">kick</span>
    </div>
    <div data-key="70" class="key">
      <kbd>F</kbd>
      <span class="sound">openhat</span>
    </div>
    <div data-key="71" class="key">
      <kbd>G</kbd>
      <span class="sound">boom</span>
    </div>
    <div data-key="72" class="key">
      <kbd>H</kbd>
      <span class="sound">ride</span>
    </div>
    <div data-key="74" class="key">
      <kbd>J</kbd>
      <span class="sound">snare</span>
    </div>
    <div data-key="75" class="key">
      <kbd>K</kbd>
      <span class="sound">tom</span>
    </div>
    <div data-key="76" class="key">
      <kbd>L</kbd>
      <span class="sound">tink</span>
    </div>
  </div>

  <audio data-key="65" src="sounds/clap.wav"></audio>
  <audio data-key="83" src="sounds/hihat.wav"></audio>
  <audio data-key="68" src="sounds/kick.wav"></audio>
  <audio data-key="70" src="sounds/openhat.wav"></audio>
  <audio data-key="71" src="sounds/boom.wav"></audio>
  <audio data-key="72" src="sounds/ride.wav"></audio>
  <audio data-key="74" src="sounds/snare.wav"></audio>
  <audio data-key="75" src="sounds/tom.wav"></audio>
  <audio data-key="76" src="sounds/tink.wav"></audio>

  <script>
    // éµç›¤ç›£è½äº‹ä»¶ï¼šæŒ‰ä¸‹éµç›¤æ™‚å‘¼å«playSound
    window.addEventListener('keydown', playSound);

    // é€édata-keyæ‰¾åˆ°éµç›¤æ‰€å°æ‡‰çš„éŸ³æ•ˆï¼Œä¸”åœ¨ç›¸å°æ‡‰çš„audioå…ƒç´ æ’­æ”¾éŸ³æ¨‚ï¼Œåœ¨ç›¸å°æ‡‰çš„divæ·»åŠ cssæ¨£å¼
    function playSound(e) {
    
      // æ‰¾å°æ‡‰ data-key å±¬æ€§å€¼ç­‰æ–¼ç•¶å‰æŒ‰éµ e.keyCode çš„ <audio> å…ƒç´ 
      const audio = document.querySelector(`audio[data-key="${e.keyCode}"]`);
      // æ‰¾åˆ°å¸¶æœ‰ data-key å±¬æ€§ä¸”å€¼ç‚º e.keyCode keyçš„å…ƒç´ ï¼ŒåŒæ™‚class=key
      const key = document.querySelector(`.key[data-key="${e.keyCode}"]`);

      // æª¢æŸ¥audioæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ASDFGHJKLä»¥å¤–çš„æŒ‰éˆ•ï¼Œä¸åšä»»ä½•åæ‡‰
      if (!audio) return;
      // å¦‚æœæ˜¯ASDFGHJKLçš„è©±ï¼Œæ¯æ¬¡æ’­æ”¾å‰ï¼Œå°‡æ’­æ”¾æ™‚é–“è¨­ç‚º 0
      // ç¢ºä¿é€£çºŒæŒ‰çš„æ™‚å€™ï¼Œä¸è«–å…ˆå‰è²éŸ³æ˜¯å¦å·²ç¶“æ’­æ”¾å®Œç•¢ï¼Œéƒ½èƒ½é‡è¤‡å¾é ­æ’­æ”¾
      audio.currentTime = 0
      // æ’­æ”¾å…ƒç´ çš„éŸ³æ•ˆ
      audio.play();
      // æ·»åŠ styleæ¨£å¼
      key.classList.add('playing');
    }


    // åŠŸèƒ½ï¼šé»æ“Šè§¸ç™¼æ·»åŠ styleå¾Œï¼Œå°±è¦ç§»é™¤playing 
    // ç§»é™¤ transition äº‹ä»¶:
    // ç•¶transitionendç§»é™¤playing
    const keys = document.querySelectorAll('.key')
    keys.forEach((key) => {
      key.addEventListener('transitionend', removeTransition)
    })

    function removeTransition (e){
      // å°å‡ºpropertyName æœ‰box-shadowã€borderã€transform...
      console.log('propertyName:', e.propertyName); 

      // æª¢æŸ¥äº‹ä»¶çš„ propertyName = 'transform'ï¼Œç¢ºä¿é€™æ˜¯èˆ‡æŒ‰éµæ¨£å¼ç›¸é—œçš„è½‰å ´æ•ˆæœã€‚
      // å¦‚æœä¸æ˜¯ï¼Œå‰‡å‡½å¼ç›´æ¥è¿”å›ï¼Œä¸åŸ·è¡Œå¾ŒçºŒçš„ä»£ç¢¼ã€‚
      if(e.propertyName !== 'transform') return

      // å¦‚æœ propertyName æ˜¯ 'transform'ï¼Œå‰‡è¡¨ç¤ºè½‰å ´æ•ˆæœå·²å®Œæˆï¼Œæ­¤æ™‚ç§»é™¤æŒ‰éµå…ƒç´ çš„ 'playing' é¡ï¼Œæ¢å¾©æŒ‰éµåŸæœ¬çš„æ¨£å¼ã€‚
      this.classList.remove('playing');
    }
  </script>


</body>

</html>